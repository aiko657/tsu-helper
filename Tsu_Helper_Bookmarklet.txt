javascript:(function(){function e(e){var t,n,o,s,i,r,a,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",f=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");f<e.length;)s=c.indexOf(e.charAt(f++)),i=c.indexOf(e.charAt(f++)),r=c.indexOf(e.charAt(f++)),a=c.indexOf(e.charAt(f++)),t=s<<2|i>>4,n=(15&i)<<4|r>>2,o=(3&r)<<6|a,u+=String.fromCharCode(t),64!=r&&(u+=String.fromCharCode(n)),64!=a&&(u+=String.fromCharCode(o));return u}function t(){$("body.newsfeed").length?(x="home",k=".comment"):$("#profile_feed").length?(x="diary",k=".comment"):document.URL.contains("/post/")?(x="post",k=".comment"):document.URL.endsWith("/friends")?x="friends":document.URL.endsWith("/followers")?x="followers":document.URL.endsWith("/following")?x="following":(document.URL.contains("/messages/")||document.URL.endsWith("/messages"))&&(x="messages",k=".messages_content .message_box")}function n(e){var t=e.split("#").length-1,n=e.split("@").length-1;if(_>=t&&v>=n)return null;var o="Limits exceeded, check your message! Are you sure you want to continue?\n";return t>_&&(o+="\n"+t+" #hashtags found. (Max. "+_+")"),n>v&&(o+="\n"+n+" @mentions found. (Max. "+v+")"),confirm(o)}function o(e){var t=null,n=null;if(e.find(".checkboxes_options_create_post input:visible").each(function(){switch($(this).attr("id")){case"facebook":t=$(this).prop("checked");break;case"twitter":n=$(this).prop("checked")}}),!1!==t&&!1!==n)return null;var o="OK = Post to Tsu";return!0===t&&(o+=", Facebook"),!0===n&&(o+=", Twitter"),confirm(o+"\nCancel = Choose other social networks")}function s(e,t){var s=e.find("#text").focus().val(),i=e.find("#title").val(),r=""!=e.find("#create_post_pic_preview").text();return""==s&&""==i&&!r||!1===n(s)||!1===o(e)?(t.preventDefault(),e.find(".loading").hide(),setTimeout(function(){e.find("#create_post_button").removeAttr("disabled")},500),!1):void 0}function i(){var e=$(".fancybox-overlay #create_post_form");return e.length?(e.find("#text").focus(),e.submit(function(e){return s($(this),e)}),void(T=!1)):void setTimeout(function(){i()},500)}function r(){$(".post_comment .load_more_post_comment_replies").each(function(){!$(this).hasClass("tsu-helper-nested-reply-parent")&&/\d+/.exec($(this).text())>0&&$(this).addClass("tsu-helper-nested-reply-parent")})}function a(){$("#message_body").focus(),$(".messages_content .message_box").each(function(){if(!$(this).hasClass("tsu-helper-tweaked")){var e=$(this).find(".message-text");e.html(e.html().trim().replace(/(?:\r\n|\r|\n)/g,"<br />")),$(this).addClass("tsu-helper-tweaked")}})}function c(e){e&&K++,F.text(K+" found.")}function u(e,t){if(!t||H){var n="/users/profiles/users_list/"+window.current_user.id+"/"+x+"/"+e,o=$.get(n,function(n){var o=$(n).siblings(".card");o.length&&(o.each(function(){$(this).find(".friend_request_box").length&&($(".profiles_list .card:not(.tsu-helper-card):first").before($(this).addClass("tsu-helper-card")),c(!0))}),t&&($(n).siblings(".loadmore_profile").length?u(e+1,!0):H=!1))}).always(function(){t||delete U[e],f()});t?W=o:U[e]=o}}function f(){var e=Object.keys(U).length;H||0!=e||d()}function l(){A=!0,H=!0,K=0,c(),F.show(),$(".tsu-helper-card").remove();for(var e=R;e>=1;e--)u(e,e==R);O.hide(),S.show()}function d(){A=!1,H=!1;for(var e in U)U[e].abort(),delete U[e];W.abort(),S.hide(),O.show()}function h(){if(window.current_user.username==$(".profile_details .summary .username").text().trim().substring(1)){var e=$(".profiles_list .title");R=Math.ceil(/\d+/.exec(e.text())/L),S=$("<a/>",{title:"Cancel current search",html:'<img class="tff-loader-wheel" src="/assets/loader.gif" /> Cancel',id:"ffr-link-cancel"}).click(function(){d()}).hide().appendTo(e),O=$("<a/>",{title:"Search for pending Friend Requests you might have missed.",html:"Find pending Friend Requests",id:"ffr-link-start"}).click(function(){l()}).appendTo(e),F=$("<span/>",{id:"ffr-status-text"}).hide().appendTo(e)}}function p(){if("MutationObserver"in window){var e=document.querySelector(C);if(e){var t=new MutationObserver(function(e){for(var t=!1,n=e.length-1;n>=0;n--){var o=e[n].target.className;if(!o.contains("comment_time_from_now")&&!o.contains("time_to_update")){t=!0;break}}if(t)switch(x){case"home":case"diary":case"post":r();break;case"messages":a()}});t.observe(e,{childList:!0,subtree:!0})}}else $.getScript("https://gist.github.com/raw/2625891/waitForKeyElements.js",function(){switch(x){case"home":case"diary":case"post":waitForKeyElements(k,r);break;case"messages":waitForKeyElements(k,a)}})}function m(){$("<style>").html("#tsu-helper-menuitem-update a:before{display:none !important;}#ffr-link-start,#ffr-link-cancel,#ffr-status-text{float:right;}#ffr-status-text{margin-right:16px;}.tsu-helper-card{background:#cfc;}.tsu-helper-nested-reply-parent{text-decoration:underline;color:#777 !important;}").appendTo("head")}function g(){$.getJSON(y,function(t){var n=parseFloat(e(t.content));if(n>w&&($("#navBarHead .tab.name").css("background-color","#F1B054"),0===$("#tsu-helper-menuitem-update").length)){var o=$("<a/>",{title:"Update Tsu Helper script to the newest version ("+n+")",href:b,html:"Update Tsu Helper!"}).attr("target","_blank").css({"background-color":"#F1B054",color:"#fff"}).click(function(){return confirm("Upgrade to the newest version ("+n+")?\n\n(refresh this page after the script has been updated)")?void 0:!1});$("<li/>",{id:"tsu-helper-menuitem-update",html:o}).appendTo("#navBarHead .sub_nav")}})}"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)==e}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return this.slice(-e.length)==e}),"function"!=typeof String.prototype.contains&&(String.prototype.contains=function(e){return this.indexOf(e)>=0}),m();var _=10,v=10,b="https://greasyfork.org/scripts/6372-tsu-helper/code/Tsu%20Helper.user.js",w=1.2,y="https://api.github.com/repos/noplanman/tsu-helper/contents/VERSION";g(),setTimeout(function(){t(),p()},500),setTimeout(function(){switch(x){case"home":case"diary":case"post":r();break;case"messages":a();break;case"followers":case"following":h()}},1e3);var k,x,C="body";$("#text").focus(),$("body").on("click",".create_post .options .add_title",function(){var e=$(this).closest("#create_post_form").find("#title");e.is(":visible")?setTimeout(function(){$("#text").focus()},50):setTimeout(function(){e.focus()},50)}),$("body").on("click",".create_post .options .filebutton, .cancel_icon_createpost",function(){var e=$(this).closest("#create_post_form").find("#text");setTimeout(function(){e.focus()},50)}),$("#create_post_form").submit(function(e){return s($(this),e)});var T=!1;$(".create_post_popup").click(function(){T||(T=!0,i())}),$("body").on("dblclick",".post_header_name, .share_header",function(e){var t=$(this).closest(".post"),n=t.find(".share_header").length,o=!$(this).hasClass("share_header");t.find("#post_link_dropdown a").each(function(){var t=$(this).text().trim().toLowerCase();if(!n&&"open"===t||!o&&"open"===t||o&&"open original post"===t){var s=$(this).attr("href");return void(e.shiftKey?window.open(s,"_blank").focus():window.location=s)}})});var S,O,F,L=12,R=0,U={},W=null,A=!1,H=!1,K=0})();